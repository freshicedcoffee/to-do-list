<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Get Sh*t Done!</title>
  <meta name="theme-color" content="#14b8a6" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <style> 
    body { margin: 0; font-family: system-ui, -apple-system, sans-serif; } 
    .dragging { opacity: 0.5; transform: scale(0.98); transition: all 0.2s; }
    .drag-over { border-top: 3px solid #14b8a6; transform: translateY(-2px); }
    
    @keyframes slide-up {
      from { transform: translateX(-50%) translateY(100px); opacity: 0; }
      to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }
    .animate-slide-up { animation: slide-up 0.3s ease-out; }
    
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in { animation: fade-in 0.4s ease-out; }
    
    @keyframes scale-in {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .scale-in { animation: scale-in 0.3s ease-out; }
    
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }
    
    .checkbox-bounce {
      transition: all 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    .checkbox-bounce:active {
      transform: scale(0.9);
    }
    
    .hover-lift {
      transition: all 0.2s ease;
    }
    
    .hover-lift:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .task-item {
      transition: all 0.3s ease;
    }
    
    .task-item:hover {
      transform: translateX(4px);
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .gradient-bg-teal {
      background: linear-gradient(135deg, #0f766e 0%, #14b8a6 50%, #2dd4bf 100%);
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .dark .glass-effect {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAvOX-RWiwyOfJKwWeEZMC4Yca1grklMJs",
      authDomain: "todolist-6dd72.firebaseapp.com",
      projectId: "todolist-6dd72",
      storageBucket: "todolist-6dd72.firebasestorage.app",
      messagingSenderId: "6906407441",
      appId: "1:6906407441:web:ff6f8463af810fe3189fb0",
      measurementId: "G-K9LMMSZKVS"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const firestore = firebase.firestore();
    firestore.enablePersistence().catch(err => {});

    const { useState, useEffect, useRef } = React;

    function Icon(tagName, props, ...children) {
      return React.createElement(tagName, props, ...children);
    }
    function Plus(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("line",{x1:12,y1:5,x2:12,y2:19}), Icon("line",{x1:5,y1:12,x2:19,y2:12})); }
    function Check(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("polyline",{points:"20 6 9 17 4 12"})); }
    function Trash2(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("polyline",{points:"3 6 5 6 21 6"}), Icon("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}), Icon("line",{x1:10,y1:11,x2:10,y2:17}), Icon("line",{x1:14,y1:11,x2:14,y2:17})); }
    function Edit2(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})); }
    function X(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("line",{x1:18,y1:6,x2:6,y2:18}), Icon("line",{x1:6,y1:6,x2:18,y2:18})); }
    function AlertCircle(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("circle",{cx:12,cy:12,r:10}), Icon("line",{x1:12,y1:8,x2:12,y2:12}), Icon("line",{x1:12,y1:16,x2:12.01,y2:16})); }
    function Calendar(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("rect",{x:3,y:4,width:18,height:18,rx:2,ry:2}), Icon("line",{x1:16,y1:2,x2:16,y2:6}), Icon("line",{x1:8,y1:2,x2:8,y2:6}), Icon("line",{x1:3,y1:10,x2:21,y2:10})); }
    function Tag(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"}), Icon("line",{x1:7,y1:7,x2:7.01,y2:7})); }
    function Sun(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("circle",{cx:12,cy:12,r:5}), Icon("line",{x1:12,y1:1,x2:12,y2:3}), Icon("line",{x1:12,y1:21,x2:12,y2:23}), Icon("line",{x1:4.22,y1:4.22,x2:5.64,y2:5.64}), Icon("line",{x1:18.36,y1:18.36,x2:19.78,y2:19.78}), Icon("line",{x1:1,y1:12,x2:3,y2:12}), Icon("line",{x1:21,y1:12,x2:23,y2:12}), Icon("line",{x1:4.22,y1:19.78,x2:5.64,y2:18.36}), Icon("line",{x1:18.36,y1:5.64,x2:19.78,y2:4.22})); }
    function Moon(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})); }
    function Settings(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("circle",{cx:12,cy:12,r:3}), Icon("path",{d:"M12 1v6m0 6v6m8.66-9l-5.2 3M8.54 14l-5.2 3m13.32 0l-5.2-3M8.54 10l-5.2-3"})); }
    function GripVertical(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("circle",{cx:9,cy:12,r:1}), Icon("circle",{cx:9,cy:5,r:1}), Icon("circle",{cx:9,cy:19,r:1}), Icon("circle",{cx:15,cy:12,r:1}), Icon("circle",{cx:15,cy:5,r:1}), Icon("circle",{cx:15,cy:19,r:1})); }
    function List(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("line",{x1:8,y1:6,x2:21,y2:6}), Icon("line",{x1:8,y1:12,x2:21,y2:12}), Icon("line",{x1:8,y1:18,x2:21,y2:18}), Icon("line",{x1:3,y1:6,x2:3.01,y2:6}), Icon("line",{x1:3,y1:12,x2:3.01,y2:12}), Icon("line",{x1:3,y1:18,x2:3.01,y2:18})); }
    function CalendarIcon(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("rect",{x:3,y:4,width:18,height:18,rx:2,ry:2}), Icon("line",{x1:16,y1:2,x2:16,y2:6}), Icon("line",{x1:8,y1:2,x2:8,y2:6}), Icon("line",{x1:3,y1:10,x2:21,y2:10})); }
    function ChevronLeft(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("polyline",{points:"15 18 9 12 15 6"})); }
    function ChevronRight(p){ return Icon("svg",{width:p.size||20,height:p.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("polyline",{points:"9 18 15 12 9 6"})); }

    const formatDate = (d) => {
      if(!d) return null;
      try { return new Date(d).toLocaleDateString(); } catch(e){ return d; }
    };

    function App(){
      const [user, setUser] = useState(null);
      const [initializing, setInitializing] = useState(true);
      const [darkMode, setDarkMode] = useState(() => {
        const saved = window.darkModePreference;
        if (saved !== undefined) return saved;
        return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      });

      useEffect(() => {
        window.darkModePreference = darkMode;
      }, [darkMode]);

      useEffect(() => {
        const unsub = auth.onAuthStateChanged(u => {
          setUser(u);
          setInitializing(false);
        });
        return () => unsub();
      }, []);

      if(initializing) {
        return React.createElement("div",{className:`min-h-screen flex items-center justify-center ${darkMode ? 'bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900' : 'bg-gradient-to-br from-teal-50 via-white to-emerald-50'}`}, 
          React.createElement("div",{className:"text-center scale-in"},
            React.createElement("div",{className:`inline-block h-12 w-12 animate-spin rounded-full border-4 border-solid ${darkMode ? 'border-teal-500 border-r-transparent' : 'border-teal-600 border-r-transparent'}`}),
            React.createElement("p",{className:`mt-4 ${darkMode ? 'text-gray-300' : 'text-gray-600'} font-medium`},"Loading...")
          )
        );
      }

      return user ? React.createElement(TodoApp,{user, darkMode, setDarkMode}) : React.createElement(AuthView,{darkMode, setDarkMode});
    }

    function AuthView({darkMode, setDarkMode}){
      const [mode, setMode] = useState('login');
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');

      const handleAuth = async () => {
        setLoading(true);
        setError('');
        try {
          if(mode === 'login') {
            await auth.signInWithEmailAndPassword(email, password);
          } else {
            await auth.createUserWithEmailAndPassword(email, password);
          }
        } catch(err) {
          setError(err.message);
        }
        setLoading(false);
      };

      const googleSignIn = async () => {
        setError('');
        const provider = new firebase.auth.GoogleAuthProvider();
        try {
          await auth.signInWithPopup(provider);
        } catch(err){
          setError(err.message || 'Google sign-in failed');
        }
      };

      return React.createElement("div",{className:`min-h-screen flex items-center justify-center p-4 ${darkMode ? 'bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900' : 'bg-gradient-to-br from-teal-50 via-white to-emerald-50'}`},
        React.createElement("div",{className:"absolute top-4 right-4"},
          React.createElement("button",{onClick:()=>setDarkMode(!darkMode),className:`p-3 rounded-full transition-all duration-300 hover-lift ${darkMode ? 'bg-gray-800 text-yellow-400 hover:bg-gray-700' : 'bg-white text-gray-700 hover:bg-gray-50 shadow-lg'}`},
            darkMode ? React.createElement(Sun,{size:20}) : React.createElement(Moon,{size:20})
          )
        ),
        React.createElement("div",{className:`w-full max-w-md fade-in`},
          React.createElement("div",{className:`${darkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white'} rounded-3xl shadow-2xl p-8 hover-lift`},
            React.createElement("div",{className:"text-center mb-8"},
              React.createElement("div",{className:`w-16 h-16 mx-auto mb-4 rounded-2xl flex items-center justify-center gradient-bg-teal shadow-lg`},
                React.createElement(Check,{size:32,className:"text-white"})
              ),
              React.createElement("h1",{className:`text-3xl font-bold mb-2 ${darkMode ? 'text-white' : 'text-gray-900'}`},"Get Sh*t Done!"),
              React.createElement("p",{className:`${darkMode ? 'text-gray-400' : 'text-gray-600'}`},"Your productivity companion")
            ),

            React.createElement("div",{className:"space-y-4 mb-6"},
              React.createElement("input",{type:"email",value:email,onChange:e=>setEmail(e.target.value),onKeyDown:e=>{ if(e.key==='Enter') handleAuth(); },placeholder:"Email",className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-teal-500' : 'bg-gray-50 border-gray-200 focus:border-teal-500 focus:bg-white'}`}),
              React.createElement("input",{type:"password",value:password,onChange:e=>setPassword(e.target.value),onKeyDown:e=>{ if(e.key==='Enter') handleAuth(); },placeholder:"Password",className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-teal-500' : 'bg-gray-50 border-gray-200 focus:border-teal-500 focus:bg-white'}`})
            ),

            error && React.createElement("div",{className:`mb-4 p-3 rounded-xl flex items-center gap-2 ${darkMode ? 'bg-red-900/30 border border-red-700 text-red-300' : 'bg-red-50 border border-red-200 text-red-700'}`},
              React.createElement(AlertCircle,{size:20}),
              React.createElement("span",{className:"text-sm"},error)
            ),

            React.createElement("button",{onClick:handleAuth,disabled:loading,className:`w-full py-3 rounded-xl font-semibold transition-all duration-300 hover-lift ${loading ? 'opacity-50 cursor-not-allowed' : ''} gradient-bg-teal text-white shadow-lg hover:shadow-xl`},
              loading ? "Processing..." : mode === 'login' ? "Sign In" : "Create Account"
            ),

            React.createElement("div",{className:"mt-6 mb-6 flex items-center gap-3"},
              React.createElement("div",{className:`flex-1 h-px ${darkMode ? 'bg-gray-700' : 'bg-gray-300'}`}),
              React.createElement("span",{className:`text-sm ${darkMode ? 'text-gray-500' : 'text-gray-400'}`},"or"),
              React.createElement("div",{className:`flex-1 h-px ${darkMode ? 'bg-gray-700' : 'bg-gray-300'}`})
            ),

            React.createElement("button",{onClick:googleSignIn,className:`w-full py-3 rounded-xl font-medium transition-all duration-300 hover-lift flex items-center justify-center gap-3 ${darkMode ? 'bg-gray-700 border-2 border-gray-600 text-white hover:bg-gray-650' : 'bg-white border-2 border-gray-300 text-gray-700 hover:bg-gray-50'} shadow-lg`}, 
              React.createElement("img",{src:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg", style:{width:20,height:20}}),
              "Continue with Google"
            ),

            React.createElement("div",{className:"mt-6 text-center"},
              React.createElement("button",{onClick:()=>setMode(mode === 'login' ? 'signup' : 'login'),className:`text-sm ${darkMode ? 'text-teal-400 hover:text-teal-300' : 'text-teal-600 hover:text-teal-700'} transition-colors`},
                mode === 'login' ? "Need an account? Sign up" : "Already have an account? Sign in"
              )
            )
          )
        )
      );
    }

    function TodoApp({user, darkMode, setDarkMode}){
      const [todos, setTodos] = useState([]);
      const [text, setText] = useState('');
      const [category, setCategory] = useState('Personal');
      const [dueDate, setDueDate] = useState('');
      const [notes, setNotes] = useState('');
      const [recurrence, setRecurrence] = useState('none');
      const [priority, setPriority] = useState('medium');
      const [filter, setFilter] = useState('all');
      const [sortBy, setSortBy] = useState('createdAt');
      const [searchTerm, setSearchTerm] = useState('');
      const [selectedCategory, setSelectedCategory] = useState('all');
      const [editingId, setEditingId] = useState(null);
      const [editText, setEditText] = useState('');
      const [editNotes, setEditNotes] = useState('');
      const [expandedNotes, setExpandedNotes] = useState({});
      const [showCategoryModal, setShowCategoryModal] = useState(false);
      const [customCategories, setCustomCategories] = useState([]);
      const [newCategory, setNewCategory] = useState('');
      const [draggedId, setDraggedId] = useState(null);
      const [showToast, setShowToast] = useState(false);
      const [deletedTask, setDeletedTask] = useState(null);
      const [showAddTask, setShowAddTask] = useState(false);

      const defaultCategories = ['Personal', 'Work', 'Shopping', 'Health', 'Other'];

      const motivationalQuotes = [
        { quote: "The secret of getting ahead is getting started.", author: "Mark Twain" },
        { quote: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
        { quote: "The future depends on what you do today.", author: "Mahatma Gandhi" },
        { quote: "You don't have to be great to start, but you have to start to be great.", author: "Zig Ziglar" },
        { quote: "Success is the sum of small efforts repeated day in and day out.", author: "Robert Collier" },
        { quote: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
        { quote: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
        { quote: "It always seems impossible until it's done.", author: "Nelson Mandela" },
        { quote: "Start where you are. Use what you have. Do what you can.", author: "Arthur Ashe" },
        { quote: "The harder you work for something, the greater you'll feel when you achieve it.", author: "Anonymous" },
        { quote: "Dream bigger. Do bigger.", author: "Anonymous" },
        { quote: "Don't stop when you're tired. Stop when you're done.", author: "Anonymous" },
        { quote: "Wake up with determination. Go to bed with satisfaction.", author: "Anonymous" },
        { quote: "Do something today that your future self will thank you for.", author: "Sean Patrick Flanery" },
        { quote: "Little things make big days.", author: "Anonymous" },
        { quote: "It's going to be hard, but hard does not mean impossible.", author: "Anonymous" },
        { quote: "Don't wait for opportunity. Create it.", author: "Anonymous" },
        { quote: "Sometimes we're tested not to show our weaknesses, but to discover our strengths.", author: "Anonymous" },
        { quote: "The key to success is to focus on goals, not obstacles.", author: "Anonymous" },
        { quote: "Dream it. Wish it. Do it.", author: "Anonymous" },
        { quote: "Success doesn't just find you. You have to go out and get it.", author: "Anonymous" },
        { quote: "Great things never come from comfort zones.", author: "Anonymous" },
        { quote: "Dream it. Believe it. Build it.", author: "Anonymous" },
        { quote: "Your limitation—it's only your imagination.", author: "Anonymous" },
        { quote: "Push yourself, because no one else is going to do it for you.", author: "Anonymous" },
        { quote: "Sometimes later becomes never. Do it now.", author: "Anonymous" },
        { quote: "The difference between ordinary and extraordinary is that little extra.", author: "Jimmy Johnson" },
        { quote: "You are never too old to set another goal or to dream a new dream.", author: "C.S. Lewis" },
        { quote: "Try to be a rainbow in someone's cloud.", author: "Maya Angelou" },
        { quote: "You are braver than you believe, stronger than you seem, and smarter than you think.", author: "A.A. Milne" }
      ];

      // Get quote based on day of year for daily rotation
      const getDailyQuote = () => {
        const now = new Date();
        const start = new Date(now.getFullYear(), 0, 0);
        const diff = now - start;
        const oneDay = 1000 * 60 * 60 * 24;
        const dayOfYear = Math.floor(diff / oneDay);
        return motivationalQuotes[dayOfYear % motivationalQuotes.length];
      };

      const dailyQuote = getDailyQuote();

      useEffect(() => {
        if(!user) return;
        const unsub = firestore.collection('todos').where('userId','==',user.uid).onSnapshot(snap => {
          const arr = snap.docs.map(d => ({id:d.id, ...d.data()}));
          setTodos(arr);
        });
        return () => unsub();
      }, [user]);

      useEffect(() => {
        if(!user) return;
        const unsub = firestore.collection('categories').doc(user.uid).onSnapshot(doc => {
          if(doc.exists) {
            setCustomCategories(doc.data().categories || []);
          }
        });
        return () => unsub();
      }, [user]);

      const addTodo = async () => {
        if(!text.trim()) return;
        const todo = {
          text: text.trim(),
          completed: false,
          userId: user.uid,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          category: category || 'Personal',
          dueDate: dueDate || null,
          notes: notes.trim() || null,
          recurrence: recurrence || 'none',
          priority: priority || 'medium'
        };
        await firestore.collection('todos').add(todo);
        setText('');
        setCategory('Personal');
        setDueDate('');
        setNotes('');
        setRecurrence('none');
        setPriority('medium');
        setShowAddTask(false);
      };

      const toggleTodo = async (id, completed, rec) => {
        const task = todos.find(t => t.id === id);
        if(!task || task.userId !== user.uid) {
          console.error('Cannot toggle task that belongs to another user');
          return;
        }
        
        try {
          await firestore.collection('todos').doc(id).update({completed: !completed});
          if(!completed && rec && rec !== 'none') {
            const todo = todos.find(t => t.id === id);
            if(todo && todo.dueDate) {
              let nextDate = new Date(todo.dueDate.seconds ? todo.dueDate.seconds * 1000 : todo.dueDate);
              if(rec === 'daily') nextDate.setDate(nextDate.getDate() + 1);
              else if(rec === 'weekly') nextDate.setDate(nextDate.getDate() + 7);
              else if(rec === 'monthly') nextDate.setMonth(nextDate.getMonth() + 1);
              await firestore.collection('todos').add({
                text: todo.text,
                completed: false,
                userId: user.uid,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                category: todo.category,
                dueDate: nextDate.toISOString(),
                notes: todo.notes,
                recurrence: todo.recurrence,
                priority: todo.priority
              });
            }
          }
        } catch(err) {
          console.error('Error toggling task:', err);
          alert('Failed to update task: ' + err.message);
        }
      };

      const deleteTodo = async (id) => {
        const task = todos.find(t => t.id === id);
        if(!task) return;
        
        // Check if this task belongs to the current user
        if(task.userId !== user.uid) {
          console.error('Cannot delete task that belongs to another user');
          return;
        }
        
        setDeletedTask({...task, id});
        try {
          await firestore.collection('todos').doc(id).delete();
          setShowToast(true);
          setTimeout(() => setShowToast(false), 5000);
        } catch(err) {
          console.error('Error deleting task:', err);
          alert('Failed to delete task: ' + err.message);
          setDeletedTask(null);
        }
      };

      const undoDelete = async () => {
        if(!deletedTask) return;
        const {id, ...taskData} = deletedTask;
        await firestore.collection('todos').add(taskData);
        setShowToast(false);
        setDeletedTask(null);
      };

      const startEdit = (id, currentText, currentNotes) => {
        setEditingId(id);
        setEditText(currentText);
        setEditNotes(currentNotes || '');
      };

      const saveEdit = async (id) => {
        if(editText.trim()) {
          const task = todos.find(t => t.id === id);
          if(!task || task.userId !== user.uid) {
            console.error('Cannot edit task that belongs to another user');
            setEditingId(null);
            setEditText('');
            setEditNotes('');
            return;
          }
          
          try {
            await firestore.collection('todos').doc(id).update({
              text: editText.trim(),
              notes: editNotes.trim() || null
            });
          } catch(err) {
            console.error('Error updating task:', err);
            alert('Failed to update task: ' + err.message);
          }
        }
        setEditingId(null);
        setEditText('');
        setEditNotes('');
      };

      const toggleNotes = (id) => {
        setExpandedNotes(prev => ({...prev, [id]: !prev[id]}));
      };

      const addCustomCategory = async () => {
        if(!newCategory.trim()) return;
        const updated = [...customCategories, newCategory.trim()];
        await firestore.collection('categories').doc(user.uid).set({categories: updated});
        setNewCategory('');
      };

      const deleteCustomCategory = async (cat) => {
        const updated = customCategories.filter(c => c !== cat);
        await firestore.collection('categories').doc(user.uid).set({categories: updated});
      };

      const clearAllTasks = async () => {
        if(!confirm('⚠️ Are you sure you want to delete ALL tasks? This action cannot be undone!')) {
          return;
        }
        
        try {
          const batch = firestore.batch();
          todos.forEach(todo => {
            const docRef = firestore.collection('todos').doc(todo.id);
            batch.delete(docRef);
          });
          await batch.commit();
          alert('All tasks have been deleted.');
        } catch(err) {
          console.error('Error clearing all tasks:', err);
          alert('Failed to clear tasks: ' + err.message);
        }
      };

      const clearCompletedTasks = async () => {
        const completedTasks = todos.filter(t => t.completed);
        
        if(completedTasks.length === 0) {
          alert('No completed tasks to clear.');
          return;
        }
        
        if(!confirm(`Are you sure you want to delete ${completedTasks.length} completed task(s)?`)) {
          return;
        }
        
        try {
          const batch = firestore.batch();
          completedTasks.forEach(todo => {
            const docRef = firestore.collection('todos').doc(todo.id);
            batch.delete(docRef);
          });
          await batch.commit();
          alert(`${completedTasks.length} completed task(s) deleted.`);
        } catch(err) {
          console.error('Error clearing completed tasks:', err);
          alert('Failed to clear completed tasks: ' + err.message);
        }
      };

      const handleDragStart = (e, id) => {
        setDraggedId(id);
        e.currentTarget.classList.add('dragging');
      };

      const handleDragEnd = (e) => {
        setDraggedId(null);
        e.currentTarget.classList.remove('dragging');
        document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
      };

      const handleDragOver = (e) => {
        e.preventDefault();
      };

      const handleDragEnter = (e, id) => {
        if(draggedId && draggedId !== id) {
          e.currentTarget.classList.add('drag-over');
        }
      };

      const handleDragLeave = (e) => {
        e.currentTarget.classList.remove('drag-over');
      };

      const handleDrop = async (e, targetId) => {
        e.preventDefault();
        e.currentTarget.classList.remove('drag-over');
        if(!draggedId || draggedId === targetId) return;

        const draggedTodo = todos.find(t => t.id === draggedId);
        const targetTodo = todos.find(t => t.id === targetId);
        
        if(draggedTodo && targetTodo) {
          const draggedOrder = draggedTodo.order || 0;
          const targetOrder = targetTodo.order || 0;
          
          try {
            await firestore.collection('todos').doc(draggedId).update({order: targetOrder});
            await firestore.collection('todos').doc(targetId).update({order: draggedOrder});
          } catch(err) {
            console.error('Error reordering tasks:', err);
          }
        }
      };

      const allCategories = [...defaultCategories, ...customCategories];

      let filteredTodos = todos.filter(t => {
        if(filter === 'active' && t.completed) return false;
        if(filter === 'completed' && !t.completed) return false;
        if(filter === 'all' && t.completed) return false; // Hide completed tasks from "all" view
        if(selectedCategory !== 'all' && t.category !== selectedCategory) return false;
        if(searchTerm && !t.text.toLowerCase().includes(searchTerm.toLowerCase())) return false;
        return true;
      });

      filteredTodos = filteredTodos.sort((a, b) => {
        if(sortBy === 'priority') {
          const priorityOrder = {high: 0, medium: 1, low: 2};
          return (priorityOrder[a.priority] || 1) - (priorityOrder[b.priority] || 1);
        }
        if(sortBy === 'dueDate') {
          if(!a.dueDate) return 1;
          if(!b.dueDate) return -1;
          const aDate = new Date(a.dueDate.seconds ? a.dueDate.seconds * 1000 : a.dueDate);
          const bDate = new Date(b.dueDate.seconds ? b.dueDate.seconds * 1000 : b.dueDate);
          return aDate - bDate;
        }
        if(sortBy === 'category') {
          return (a.category || '').localeCompare(b.category || '');
        }
        if(sortBy === 'createdAt') {
          const aTime = a.createdAt?.seconds || 0;
          const bTime = b.createdAt?.seconds || 0;
          return bTime - aTime;
        }
        return (a.order || 0) - (b.order || 0);
      });

      const stats = {
        total: todos.length,
        completed: todos.filter(t => t.completed).length,
        active: todos.filter(t => !t.completed).length
      };

      return React.createElement("div",{className:`min-h-screen ${darkMode ? 'bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900' : 'bg-gradient-to-br from-teal-50 via-white to-emerald-50'}`},
        React.createElement("div",{className:"max-w-5xl mx-auto p-4 sm:p-6 lg:p-8"},
          
          React.createElement("div",{className:`mb-6 fade-in`},
            React.createElement("div",{className:`${darkMode ? 'bg-gradient-to-r from-teal-900/40 to-emerald-900/40 border border-teal-700/50' : 'bg-gradient-to-r from-teal-50 to-emerald-50 border border-teal-200/50'} rounded-2xl p-6 shadow-lg backdrop-blur-sm`},
              React.createElement("div",{className:"flex items-start gap-4"},
                React.createElement("div",{className:`text-4xl ${darkMode ? 'text-teal-400' : 'text-teal-600'} leading-none`},"✨"),
                React.createElement("div",{className:"flex-1"},
                  React.createElement("p",{className:`${darkMode ? 'text-gray-200' : 'text-gray-700'} text-lg italic leading-relaxed mb-2`},`"${dailyQuote.quote}"`),
                  React.createElement("p",{className:`${darkMode ? 'text-teal-400' : 'text-teal-600'} text-sm font-medium`},`— ${dailyQuote.author}`)
                )
              )
            )
          ),

          React.createElement("div",{className:`mb-8 fade-in`},
            React.createElement("div",{className:"flex items-center justify-between mb-6"},
              React.createElement("div",null,
                React.createElement("h1",{className:`text-3xl sm:text-4xl font-bold mb-2 ${darkMode ? 'text-white' : 'text-gray-900'}`},"Get Sh*t Done! 🚀"),
                React.createElement("p",{className:`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`},user.email)
              ),
              React.createElement("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3"},
                React.createElement("button",{onClick:clearCompletedTasks,className:`px-3 sm:px-4 py-2 sm:py-3 rounded-xl text-xs sm:text-sm font-medium transition-all duration-300 hover-lift ${darkMode ? 'bg-orange-900/30 text-orange-400 hover:bg-orange-900/50 border border-orange-700' : 'bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200'} shadow-lg`},"Clear Completed"),
                React.createElement("button",{onClick:clearAllTasks,className:`px-3 sm:px-4 py-2 sm:py-3 rounded-xl text-xs sm:text-sm font-medium transition-all duration-300 hover-lift ${darkMode ? 'bg-red-900/30 text-red-400 hover:bg-red-900/50 border border-red-700' : 'bg-red-50 text-red-600 hover:bg-red-100 border border-red-200'} shadow-lg`},"Clear All"),
                React.createElement("button",{onClick:()=>setDarkMode(!darkMode),className:`p-2 sm:p-3 rounded-xl transition-all duration-300 hover-lift ${darkMode ? 'bg-gray-800 text-yellow-400 hover:bg-gray-700' : 'bg-white text-gray-700 hover:bg-gray-50 shadow-lg'}`},
                  darkMode ? React.createElement(Sun,{size:20}) : React.createElement(Moon,{size:20})
                ),
                React.createElement("button",{onClick:()=>auth.signOut(),className:`px-3 sm:px-4 py-2 sm:py-3 rounded-xl text-xs sm:text-sm font-medium transition-all duration-300 hover-lift ${darkMode ? 'bg-gray-800 text-white hover:bg-gray-700' : 'bg-white text-gray-700 hover:bg-gray-50 shadow-lg'}`},"Sign Out")
              )
            ),

            React.createElement("div",{className:`grid grid-cols-3 gap-4 mb-6`},
              React.createElement("div",{className:`${darkMode ? 'bg-gradient-to-br from-teal-900 to-teal-800 border border-teal-700' : 'bg-gradient-to-br from-teal-500 to-teal-600'} rounded-2xl p-5 text-white shadow-xl hover-lift`},
                React.createElement("div",{className:"text-3xl font-bold mb-1"},stats.total),
                React.createElement("div",{className:"text-sm opacity-90"},"Total Tasks")
              ),
              React.createElement("div",{className:`${darkMode ? 'bg-gradient-to-br from-emerald-900 to-emerald-800 border border-emerald-700' : 'bg-gradient-to-br from-emerald-500 to-emerald-600'} rounded-2xl p-5 text-white shadow-xl hover-lift`},
                React.createElement("div",{className:"text-3xl font-bold mb-1"},stats.completed),
                React.createElement("div",{className:"text-sm opacity-90"},"Completed")
              ),
              React.createElement("div",{className:`${darkMode ? 'bg-gradient-to-br from-cyan-900 to-cyan-800 border border-cyan-700' : 'bg-gradient-to-br from-cyan-500 to-cyan-600'} rounded-2xl p-5 text-white shadow-xl hover-lift`},
                React.createElement("div",{className:"text-3xl font-bold mb-1"},stats.active),
                React.createElement("div",{className:"text-sm opacity-90"},"Active")
              )
            )
          ),

          React.createElement("div",{className:`${darkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white'} rounded-3xl shadow-2xl overflow-hidden mb-6 scale-in`},
            !showAddTask ?
              React.createElement("button",{onClick:()=>setShowAddTask(true),className:`w-full p-6 flex items-center justify-center gap-3 transition-all duration-300 ${darkMode ? 'hover:bg-gray-750' : 'hover:bg-gray-50'}`},
                React.createElement("div",{className:"w-12 h-12 rounded-full gradient-bg-teal flex items-center justify-center shadow-lg"},
                  React.createElement(Plus,{size:24,className:"text-white"})
                ),
                React.createElement("span",{className:`text-lg font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'}`},"Add New Task")
              ) :
              React.createElement("div",{className:"p-6"},
                React.createElement("div",{className:"flex items-center justify-between mb-4"},
                  React.createElement("h3",{className:`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`},"Create New Task"),
                  React.createElement("button",{onClick:()=>setShowAddTask(false),className:`p-2 rounded-xl transition-colors ${darkMode ? 'hover:bg-gray-700 text-gray-400' : 'hover:bg-gray-100 text-gray-600'}`},
                    React.createElement(X,{size:20})
                  )
                ),
                React.createElement("div",{className:"space-y-4"},
                  React.createElement("input",{type:"text",value:text,onChange:e=>setText(e.target.value),onKeyDown:e=>{ if(e.key==='Enter' && !e.shiftKey) addTodo(); },placeholder:"What needs to be done?",className:`w-full px-4 py-4 text-lg rounded-xl border-2 transition-all duration-200 focus:outline-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-teal-500' : 'bg-gray-50 border-gray-200 focus:border-teal-500 focus:bg-white'}`}),

                  React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3"},
                    React.createElement("select",{value:category,onChange:e=>setCategory(e.target.value),className:`px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white focus:border-teal-500' : 'bg-gray-50 border-gray-200 focus:border-teal-500 focus:bg-white'}`},
                      allCategories.map(cat => React.createElement("option",{key:cat,value:cat},cat))
                    ),
                    React.createElement("select",{value:priority,onChange:e=>setPriority(e.target.value),className:`px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white focus:border-teal-500' : 'bg-gray-50 border-gray-200 focus:border-teal-500 focus:bg-white'}`},
                      React.createElement("option",{value:"low"},"Low Priority"),
                      React.createElement("option",{value:"medium"},"Medium Priority"),
                      React.createElement("option",{value:"high"},"High Priority")
                    ),
                    React.createElement("select",{value:recurrence,onChange:e=>setRecurrence(e.target.value),className:`px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white focus:border-teal-500' : 'bg-gray-50 border-gray-200 focus:border-teal-500 focus:bg-white'}`},
                      React.createElement("option",{value:"none"},"No Repeat"),
                      React.createElement("option",{value:"daily"},"Daily"),
                      React.createElement("option",{value:"weekly"},"Weekly"),
                      React.createElement("option",{value:"monthly"},"Monthly")
                    )
                  ),

                  React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3"},
                    React.createElement("input",{type:"date",value:dueDate,onChange:e=>setDueDate(e.target.value),className:`px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white focus:border-teal-500' : 'bg-gray-50 border-gray-200 focus:border-teal-500 focus:bg-white'}`}),
                    React.createElement("textarea",{value:notes,onChange:e=>setNotes(e.target.value),placeholder:"Add notes...",rows:1,className:`px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none resize-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-teal-500' : 'bg-gray-50 border-gray-200 focus:border-teal-500 focus:bg-white'}`})
                  ),

                  React.createElement("div",{className:"flex gap-3"},
                    React.createElement("button",{onClick:addTodo,className:"flex-1 py-4 rounded-xl font-semibold transition-all duration-300 hover-lift gradient-bg-teal text-white shadow-lg hover:shadow-xl flex items-center justify-center gap-2"},
                      React.createElement(Plus,{size:20}),
                      "Add Task"
                    ),
                    React.createElement("button",{onClick:()=>setShowCategoryModal(true),className:`px-6 py-4 rounded-xl font-medium transition-all duration-300 hover-lift ${darkMode ? 'bg-gray-700 text-white hover:bg-gray-600' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'} shadow-lg`},
                      React.createElement(Settings,{size:20})
                    )
                  )
                )
              )
          ),

          React.createElement("div",{className:`${darkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white'} rounded-3xl shadow-2xl p-6 mb-6 fade-in`},
            React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3"},
              React.createElement("input",{type:"text",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),placeholder:"Search tasks...",className:`px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-teal-500' : 'bg-gray-50 border-gray-200 focus:border-teal-500 focus:bg-white'}`}),
              React.createElement("select",{value:filter,onChange:e=>setFilter(e.target.value),className:`px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white focus:border-teal-500' : 'bg-gray-50 border-gray-200 focus:border-teal-500 focus:bg-white'}`},
                React.createElement("option",{value:"all"},"Active Tasks"),
                React.createElement("option",{value:"completed"},"Completed Tasks")
              ),
              React.createElement("select",{value:selectedCategory,onChange:e=>setSelectedCategory(e.target.value),className:`px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white focus:border-teal-500' : 'bg-gray-50 border-gray-200 focus:border-teal-500 focus:bg-white'}`},
                React.createElement("option",{value:"all"},"All Categories"),
                allCategories.map(cat => React.createElement("option",{key:cat,value:cat},cat))
              ),
              React.createElement("select",{value:sortBy,onChange:e=>setSortBy(e.target.value),className:`px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white focus:border-teal-500' : 'bg-gray-50 border-gray-200 focus:border-teal-500 focus:bg-white'}`},
                React.createElement("option",{value:"createdAt"},"Sort by Date"),
                React.createElement("option",{value:"priority"},"Sort by Priority"),
                React.createElement("option",{value:"dueDate"},"Sort by Due Date"),
                React.createElement("option",{value:"category"},"Sort by Category")
              )
            )
          ),

          React.createElement("div",{className:"space-y-3"},
            filteredTodos.length === 0 ? 
              React.createElement("div",{className:`${darkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white'} rounded-3xl shadow-xl p-12 text-center fade-in`},
                React.createElement("div",{className:"text-6xl mb-4"},"📝"),
                React.createElement("p",{className:`text-xl ${darkMode ? 'text-gray-400' : 'text-gray-600'}`},"No tasks found. Time to get organized!")
              ) :
            filteredTodos.map((todo, idx) => {
              // Get today's date at midnight in local timezone
              const today = new Date();
              today.setHours(0, 0, 0, 0);
              
              const tomorrow = new Date(today);
              tomorrow.setDate(tomorrow.getDate() + 1);
              
              let taskDate = null;
              if(todo.dueDate) {
                if(todo.dueDate.seconds) {
                  // Firestore timestamp - convert to local date
                  taskDate = new Date(todo.dueDate.seconds * 1000);
                } else if(typeof todo.dueDate === 'string') {
                  // String date from input (YYYY-MM-DD format)
                  // Parse as local date, not UTC
                  const parts = todo.dueDate.split('-');
                  taskDate = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
                } else {
                  taskDate = new Date(todo.dueDate);
                }
                // Reset to midnight local time
                taskDate.setHours(0, 0, 0, 0);
              }
              
              const dueToday = taskDate && taskDate.getTime() === today.getTime();
              const dueTomorrow = taskDate && taskDate.getTime() === tomorrow.getTime();
              const overdueTask = taskDate && taskDate < today && !todo.completed;

              return React.createElement("div",{
                key:todo.id,
                draggable:true,
                onDragStart:e=>handleDragStart(e,todo.id),
                onDragEnd:handleDragEnd,
                onDragOver:handleDragOver,
                onDragEnter:e=>handleDragEnter(e,todo.id),
                onDragLeave:handleDragLeave,
                onDrop:e=>handleDrop(e,todo.id),
                className:`${darkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white'} rounded-2xl shadow-lg p-5 task-item hover-lift ${todo.completed ? 'opacity-60' : ''} fade-in ${
                  overdueTask ? 'border-l-4 !border-l-red-500' : 
                  dueToday ? 'border-l-4 !border-l-yellow-500' : 
                  dueTomorrow ? 'border-l-4 !border-l-green-500' : ''
                }`,
                style:{animationDelay: `${idx * 0.05}s`}
              },
                React.createElement("div",{className:"flex items-start gap-4"},
                  React.createElement("button",{className:`flex-shrink-0 cursor-grab active:cursor-grabbing ${darkMode ? 'text-gray-600 hover:text-gray-500' : 'text-gray-400 hover:text-gray-500'} transition-colors`},
                    React.createElement(GripVertical,{size:20})
                  ),

                  React.createElement("button",{onClick:()=>toggleTodo(todo.id, todo.completed, todo.recurrence),className:`flex-shrink-0 w-6 h-6 rounded-lg border-2 transition-all duration-200 checkbox-bounce ${todo.completed ? darkMode ? 'bg-teal-600 border-teal-600' : 'bg-teal-500 border-teal-500' : darkMode ? 'border-gray-600 hover:border-teal-500' : 'border-gray-300 hover:border-teal-400'} flex items-center justify-center`},
                    todo.completed && React.createElement(Check,{size:16,className:"text-white"})
                  ),

                  React.createElement("div",{className:"flex-1 min-w-0"},
                    editingId === todo.id ?
                      React.createElement("div",{key:todo.id,className:"space-y-3"},
                        React.createElement("input",{type:"text",value:editText,onChange:e=>setEditText(e.target.value),onKeyDown:e=>{ if(e.key==='Enter') saveEdit(todo.id); if(e.key==='Escape') { setEditingId(null); setEditText(''); setEditNotes(''); } },className:`w-full px-3 py-2 rounded-xl border-2 transition-all duration-200 focus:outline-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white focus:border-teal-500' : 'bg-gray-50 border-gray-200 focus:border-teal-500'}`}),
                        React.createElement("textarea",{
                          key:`notes-${todo.id}`,
                          defaultValue:editNotes,
                          onChange:e=>setEditNotes(e.target.value),
                          placeholder:"Edit notes...",
                          rows:3,
                          className:`w-full px-3 py-2 rounded-xl border-2 transition-all duration-200 focus:outline-none resize-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-teal-500' : 'bg-gray-50 border-gray-200 placeholder-gray-400 focus:border-teal-500'}`
                        }),
                        React.createElement("div",{className:"flex gap-2"},
                          React.createElement("button",{onClick:()=>saveEdit(todo.id),className:`px-4 py-2 rounded-xl font-medium transition-all duration-300 gradient-bg-teal text-white hover-lift`},"Save"),
                          React.createElement("button",{onClick:()=>{ setEditingId(null); setEditText(''); setEditNotes(''); },className:`px-4 py-2 rounded-xl font-medium transition-all duration-300 ${darkMode ? 'bg-gray-700 text-white hover:bg-gray-600' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`},"Cancel")
                        )
                      ) :
                      React.createElement("div",null,
                        React.createElement("div",{className:`text-lg mb-2 ${todo.completed ? 'line-through opacity-60' : ''} ${darkMode ? 'text-white' : 'text-gray-900'}`},todo.text),

                        React.createElement("div",{className:"flex flex-wrap gap-2 mb-2"},
                          todo.priority && React.createElement("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-lg text-xs font-medium ${todo.priority === 'high' ? darkMode ? 'bg-red-900/40 text-red-300 border border-red-700' : 'bg-red-100 text-red-700 border border-red-200' : todo.priority === 'low' ? darkMode ? 'bg-gray-700 text-gray-300 border border-gray-600' : 'bg-gray-100 text-gray-600 border border-gray-200' : darkMode ? 'bg-amber-900/40 text-amber-300 border border-amber-700' : 'bg-amber-100 text-amber-700 border border-amber-200'}`},
                            todo.priority === 'high' ? '🔥' : todo.priority === 'low' ? '⬇️' : '⚡',
                            todo.priority.charAt(0).toUpperCase() + todo.priority.slice(1)
                          ),
                          React.createElement("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-lg text-xs font-medium ${darkMode ? 'bg-purple-900/40 text-purple-300 border border-purple-700' : 'bg-purple-100 text-purple-700 border border-purple-200'}`},
                            React.createElement(Tag,{size:12}),
                            todo.category || 'Other'
                          ),
                          todo.recurrence && todo.recurrence !== 'none' ? React.createElement("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-lg text-xs font-medium ${darkMode ? 'bg-cyan-900/40 text-cyan-300 border border-cyan-700' : 'bg-cyan-100 text-cyan-700 border border-cyan-200'}`},
                            "🔄",
                            todo.recurrence.charAt(0).toUpperCase() + todo.recurrence.slice(1)
                          ) : null,
                          todo.dueDate ? React.createElement("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-lg text-xs font-medium ${ overdueTask ? darkMode ? 'bg-red-900/40 text-red-200 border border-red-700' : 'bg-red-100 text-red-700 border border-red-300' : dueToday ? darkMode ? 'bg-yellow-900/40 text-yellow-200 border border-yellow-700' : 'bg-yellow-100 text-yellow-700 border border-yellow-300' : dueTomorrow ? darkMode ? 'bg-green-900/40 text-green-200 border border-green-700' : 'bg-green-100 text-green-700 border border-green-300' : darkMode ? 'bg-blue-900/40 text-blue-300 border border-blue-700' : 'bg-blue-100 text-blue-700 border border-blue-200' }`},
                            React.createElement(Calendar,{size:12}),
                            (todo.dueDate && todo.dueDate.seconds) ? new Date(todo.dueDate.seconds*1000).toLocaleDateString() : (typeof todo.dueDate === 'string' ? formatDate(todo.dueDate) : String(todo.dueDate)),
                            overdueTask ? ' (Overdue!)' : dueToday ? ' (Today!)' : dueTomorrow ? ' (Tomorrow)' : null
                          ) : null
                        ),

                        todo.notes && React.createElement("div",{className:"mt-3"},
                          React.createElement("button",{onClick:()=>toggleNotes(todo.id),className:`text-xs ${darkMode ? 'text-teal-400 hover:text-teal-300' : 'text-teal-600 hover:text-teal-700'} flex items-center gap-1 font-medium transition-colors`},
                            expandedNotes[todo.id] ? '▼' : '▶',
                            expandedNotes[todo.id] ? 'Hide Notes' : 'Show Notes'
                          ),
                          expandedNotes[todo.id] && React.createElement("div",{className:`mt-2 p-4 rounded-xl ${darkMode ? 'bg-gray-900/50 text-gray-300 border border-gray-700' : 'bg-teal-50/50 text-gray-700 border border-teal-100'} text-sm whitespace-pre-wrap`},
                            todo.notes
                          )
                        )
                      )
                  ),

                  React.createElement("div",{className:"flex items-center gap-2 flex-shrink-0"},
                    React.createElement("button",{onClick:()=>startEdit(todo.id, todo.text, todo.notes),className:`p-2 rounded-lg transition-all duration-200 ${darkMode ? 'text-teal-400 hover:bg-gray-700' : 'text-teal-600 hover:bg-teal-50'}`},
                      React.createElement(Edit2,{size:18})
                    ),
                    React.createElement("button",{onClick:()=>deleteTodo(todo.id),className:`p-2 rounded-lg transition-all duration-200 ${darkMode ? 'text-red-400 hover:bg-gray-700' : 'text-red-600 hover:bg-red-50'}`},
                      React.createElement(Trash2,{size:18})
                    )
                  )
                )
              );
            })
          ),

          showCategoryModal && React.createElement("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 fade-in",onClick:()=>setShowCategoryModal(false)},
            React.createElement("div",{className:`${darkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white'} rounded-3xl p-8 max-w-md w-full shadow-2xl scale-in`,onClick:e=>e.stopPropagation()},
              React.createElement("div",{className:"flex items-center justify-between mb-6"},
                React.createElement("h3",{className:`text-2xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`},"Manage Categories"),
                React.createElement("button",{onClick:()=>setShowCategoryModal(false),className:`p-2 rounded-xl transition-colors ${darkMode ? 'hover:bg-gray-700 text-gray-400' : 'hover:bg-gray-100 text-gray-600'}`},
                  React.createElement(X,{size:24})
                )
              ),

              React.createElement("div",{className:"mb-6"},
                React.createElement("label",{className:`block text-sm font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-3`},"Add New Category"),
                React.createElement("div",{className:"flex gap-2"},
                  React.createElement("input",{type:"text",value:newCategory,onChange:e=>setNewCategory(e.target.value),onKeyDown:e=>{ if(e.key==='Enter') addCustomCategory(); },placeholder:"Enter category name...",className:`flex-1 px-4 py-3 border-2 rounded-xl transition-all duration-200 focus:outline-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-teal-500' : 'bg-gray-50 border-gray-200 placeholder-gray-400 focus:border-teal-500'}`}),
                  React.createElement("button",{onClick:addCustomCategory,className:"px-5 py-3 gradient-bg-teal text-white rounded-xl flex items-center gap-2 font-medium hover-lift"},
                    React.createElement(Plus,{size:18}),
                    "Add"
                  )
                )
              ),

              React.createElement("div",{className:"space-y-3"},
                React.createElement("label",{className:`block text-sm font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-3`},"Your Categories"),
                React.createElement("div",{className:"space-y-2 max-h-80 overflow-y-auto pr-2"},
                  defaultCategories.map(cat => 
                    React.createElement("div",{key:cat,className:`flex items-center justify-between p-4 rounded-xl ${darkMode ? 'bg-gray-700/50 border border-gray-600' : 'bg-gray-50 border border-gray-200'}`},
                      React.createElement("span",{className:`font-medium ${darkMode ? 'text-gray-200' : 'text-gray-700'}`},cat),
                      React.createElement("span",{className:`text-xs px-2 py-1 rounded-lg ${darkMode ? 'bg-gray-600 text-gray-400' : 'bg-gray-200 text-gray-500'}`},"Default")
                    )
                  ),
                  customCategories.length === 0 ? 
                    React.createElement("p",{className:`text-sm ${darkMode ? 'text-gray-500' : 'text-gray-400'} italic py-8 text-center`},"No custom categories yet") :
                    customCategories.map(cat => 
                      React.createElement("div",{key:cat,className:`flex items-center justify-between p-4 rounded-xl transition-all ${darkMode ? 'bg-gray-700 hover:bg-gray-650 border border-gray-600' : 'bg-gray-50 hover:bg-gray-100 border border-gray-200'}`},
                        React.createElement("span",{className:`font-medium ${darkMode ? 'text-gray-200' : 'text-gray-700'}`},cat),
                        React.createElement("button",{onClick:()=>deleteCustomCategory(cat),className:`text-red-500 hover:text-red-400 p-2 rounded-lg transition-colors ${darkMode ? 'hover:bg-gray-600' : 'hover:bg-red-50'}`},
                          React.createElement(Trash2,{size:18})
                        )
                      )
                    )
                )
              ),

              React.createElement("div",{className:"mt-8 flex justify-end"},
                React.createElement("button",{onClick:()=>setShowCategoryModal(false),className:`px-6 py-3 rounded-xl font-medium transition-all duration-300 ${darkMode ? 'bg-gray-700 hover:bg-gray-600 text-white' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'} hover-lift`},"Done")
              )
            )
          ),

          showToast && deletedTask && React.createElement("div",{className:"fixed bottom-8 left-1/2 transform -translate-x-1/2 z-50 animate-slide-up"},
            React.createElement("div",{className:`${darkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'} px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-4 min-w-96`},
              React.createElement("div",{className:"flex items-center gap-3 flex-1"},
                React.createElement("div",{className:`p-2 rounded-lg ${darkMode ? 'bg-red-900/30' : 'bg-red-100'}`},
                  React.createElement(Trash2,{size:20,className:darkMode ? 'text-red-400' : 'text-red-600'})
                ),
                React.createElement("div",null,
                  React.createElement("div",{className:`font-semibold ${darkMode ? 'text-white' : 'text-gray-900'}`},"Task deleted"),
                  React.createElement("div",{className:`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} truncate max-w-xs`},deletedTask.text)
                )
              ),
              React.createElement("button",{onClick:undoDelete,className:"px-5 py-2 gradient-bg-teal text-white rounded-xl font-medium transition-all hover-lift"},"Undo")
            )
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>