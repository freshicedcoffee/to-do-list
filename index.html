<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Get Sh*t Done!</title>
  <meta name="theme-color" content="#6366f1" />
  <!-- Tailwind for quick styles -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Firebase (compat libs are easiest for in-browser use without build tools) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <style> body { margin: 0; font-family: system-ui, -apple-system, sans-serif; } </style>
</head>
<body>
  <div id="root"></div>

  <script>

  const firebaseConfig = {
    apiKey: "AIzaSyAvOX-RWiwyOfJKwWeEZMC4Yca1grklMJs",
    authDomain: "todolist-6dd72.firebaseapp.com",
    projectId: "todolist-6dd72",
    storageBucket: "todolist-6dd72.firebasestorage.app",
    messagingSenderId: "6906407441",
    appId: "1:6906407441:web:ff6f8463af810fe3189fb0",
    measurementId: "G-K9LMMSZKVS"
  };


  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const firestore = firebase.firestore();

  // Try to enable offline persistence (fails if multiple tabs unsupported)
  firestore.enablePersistence().catch(function(err) {
    // console.warn('Persistence not enabled:', err);
  });

  const { useState, useEffect } = React;

  /* ---------- small SVG icon components (React.createElement style) ---------- */
  function Icon(tagName, props, ...children) {
    return React.createElement(tagName, props, ...children);
  }
  function Plus(props){ return Icon("svg",{width:props.size||20,height:props.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("line",{x1:12,y1:5,x2:12,y2:19}), Icon("line",{x1:5,y1:12,x2:19,y2:12})); }
  function Check(props){ return Icon("svg",{width:props.size||20,height:props.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("polyline",{points:"20 6 9 17 4 12"})); }
  function Trash2(props){ return Icon("svg",{width:props.size||20,height:props.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("polyline",{points:"3 6 5 6 21 6"}), Icon("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}), Icon("line",{x1:10,y1:11,x2:10,y2:17}), Icon("line",{x1:14,y1:11,x2:14,y2:17})); }
  function Edit2(props){ return Icon("svg",{width:props.size||20,height:props.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})); }
  function X(props){ return Icon("svg",{width:props.size||20,height:props.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("line",{x1:18,y1:6,x2:6,y2:18}), Icon("line",{x1:6,y1:6,x2:18,y2:18})); }
  function AlertCircle(props){ return Icon("svg",{width:props.size||20,height:props.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("circle",{cx:12,cy:12,r:10}), Icon("line",{x1:12,y1:8,x2:12,y2:12}), Icon("line",{x1:12,y1:16,x2:12.01,y2:16})); }
  function Calendar(props){ return Icon("svg",{width:props.size||20,height:props.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("rect",{x:3,y:4,width:18,height:18,rx:2,ry:2}), Icon("line",{x1:16,y1:2,x2:16,y2:6}), Icon("line",{x1:8,y1:2,x2:8,y2:6}), Icon("line",{x1:3,y1:10,x2:21,y2:10})); }
  function Tag(props){ return Icon("svg",{width:props.size||20,height:props.size||20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2}, Icon("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"}), Icon("line",{x1:7,y1:7,x2:7.01,y2:7})); }

  /* ---------- Helper functions ---------- */
  const formatDate = (d) => {
    if(!d) return null;
    try { return new Date(d).toLocaleDateString(); } catch(e){ return d; }
  };

  /* ---------- Main App ---------- */
  function App(){
    const [user, setUser] = useState(null);
    const [initializing, setInitializing] = useState(true);

    // Auth state listener
    useEffect(() => {
      const unsub = auth.onAuthStateChanged(u => {
        setUser(u);
        setInitializing(false);
      });
      return () => unsub();
    }, []);

    if(initializing) {
      return React.createElement("div",{className:"min-h-screen flex items-center justify-center"}, React.createElement("div",null,"Loading..."));
    }

    return user ? React.createElement(TodoAppWithAuth,{user}) : React.createElement(AuthView,null);
  }

  /* ---------- Authentication view (signup / login + Google) ---------- */
  function AuthView(){
    const [mode, setMode] = useState('login'); // 'login' or 'signup'
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState('');

    const doEmailAuth = async () => {
      setError('');
      if(!email || !password){ setError('Email and password required'); return; }
      setLoading(true);
      try {
        if(mode === 'signup'){
          await auth.createUserWithEmailAndPassword(email, password);
        } else {
          await auth.signInWithEmailAndPassword(email, password);
        }
      } catch(err){
        setError(err.message || 'Auth error');
      } finally { setLoading(false); }
    };

    const googleSignIn = async () => {
      setError('');
      const provider = new firebase.auth.GoogleAuthProvider();
      try {
        await auth.signInWithPopup(provider);
      } catch(err){
        setError(err.message || 'Google sign-in failed');
      }
    };

    return React.createElement("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-blue-50 to-indigo-100"},
      React.createElement("div",{className:"w-full max-w-md bg-white rounded-2xl p-6 shadow-lg"},
        React.createElement("h2",{className:"text-2xl font-bold mb-2 text-gray-800"},"Let's get sh*t done!"),
        React.createElement("p",{className:"text-sm text-gray-500 mb-4"},"Sign in to sync your tasks across devices."),

        error && React.createElement("div",{className:"mb-3 text-sm text-red-600"}, error),

        React.createElement("div",{className:"mb-3"},
          React.createElement("label",{className:"block text-xs text-gray-600 mb-1"},"Email"),
          React.createElement("input",{type:"email",value:email,onChange:e=>setEmail(e.target.value),className:"w-full px-3 py-2 border rounded"})
        ),
        React.createElement("div",{className:"mb-4"},
          React.createElement("label",{className:"block text-xs text-gray-600 mb-1"},"Password"),
          React.createElement("input",{type:"password",value:password,onChange:e=>setPassword(e.target.value),className:"w-full px-3 py-2 border rounded"})
        ),
        React.createElement("div",{className:"flex gap-2 mb-4"},
          React.createElement("button",{onClick:doEmailAuth,disabled:loading,className:"flex-1 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded"}, loading ? 'Please wait...' : (mode==='signup' ? 'Create account' : 'Sign in') ),
          React.createElement("button",{onClick:()=>setMode(mode==='signup'?'login':'signup'),className:"px-3 py-2 rounded border"}, mode==='signup' ? 'Have an account?' : 'Create account')
        ),
        React.createElement("div",{className:"mb-2 text-center text-gray-400"},"or"),
        React.createElement("div",{className:"flex"},
          React.createElement("button",{onClick:googleSignIn,className:"w-full bg-white border rounded py-2 flex items-center justify-center gap-2"}, 
            React.createElement("img",{src:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg", style:{width:20,height:20}}),
            "Sign in with Google"
          )
        ),

        React.createElement("p",{className:"mt-4 text-xs text-gray-400"},"Thanks for checking this out!")
      )
    );
  }

  /* ---------- Todo app (when logged in) ---------- */
  function TodoAppWithAuth({ user }){
    // local UI state
    const [todos, setTodos] = useState([]);
    const [input, setInput] = useState('');
    const [category, setCategory] = useState('');
    const [dueDate, setDueDate] = useState('');
    const [priority, setPriority] = useState('medium');
    const [filter, setFilter] = useState('all');
    const [editingId, setEditingId] = useState(null);
    const [editText, setEditText] = useState('');
    const [loading, setLoading] = useState(true);

    const categories = ['Work','Personal','Shopping','Health','Other'];
    const priorities = ['low','medium','high'];

    // Firestore collection reference for this user's tasks
    const tasksRef = () => firestore.collection('users').doc(user.uid).collection('tasks');

    // subscribe to tasks
    useEffect(() => {
      setLoading(true);
      const q = tasksRef().orderBy('priorityIndex','asc').orderBy('createdAt','asc');
      const unsub = q.onSnapshot(snapshot => {
        const items = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        setTodos(items);
        setLoading(false);
      }, err => {
        console.error('tasks snapshot error', err);
        setLoading(false);
      });
      return () => unsub();
    }, [user.uid]);

    // helpers for priority index ordering
    const priorityIndex = p => ({high:0, medium:1, low:2}[p] ?? 1);

    // add / edit / delete functions -> write to Firestore
    const addTodo = async () => {
      if(!input.trim()) return;
      const data = {
        text: input,
        completed: false,
        category: category || 'Other',
        dueDate: dueDate || null,
        priority,
        priorityIndex: priorityIndex(priority),
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      try {
        await tasksRef().add(data);
        setInput(''); setCategory(''); setDueDate(''); setPriority('medium');
      } catch(err){
        console.error('addTodo error', err);
      }
    };

    const toggleTodo = async (id, current) => {
      try {
        await tasksRef().doc(id).update({ completed: !current });
      } catch(err){ console.error(err); }
    };
    const deleteTodo = async (id) => {
      try { await tasksRef().doc(id).delete(); } catch(err){ console.error(err); }
    };
    const startEdit = (todo) => { setEditingId(todo.id); setEditText(todo.text); };
    const saveEdit = async (id) => {
      if(!editText.trim()) { setEditingId(null); setEditText(''); return; }
      try { await tasksRef().doc(id).update({ text: editText }); } catch(err){ console.error(err); }
      setEditingId(null); setEditText('');
    };
    const clearCompleted = async () => {
      const batch = firestore.batch();
      const snapshot = await tasksRef().where('completed','==',true).get();
      snapshot.forEach(doc => batch.delete(doc.ref));
      await batch.commit();
    };
    const clearAll = async () => {
      if(!confirm('Delete ALL tasks?')) return;
      // caution: batched delete (Firestore limits 500 ops per batch)
      const snapshot = await tasksRef().get();
      const batch = firestore.batch();
      snapshot.forEach(doc => batch.delete(doc.ref));
      await batch.commit();
    };

    const isOverdue = (d) => {
      if(!d) return false;
      const due = new Date(d.seconds ? d.seconds * 1000 : d);
      const today = new Date();
      return due < today && due.toDateString() !== today.toDateString();
    };

    const filtered = todos.filter(t => filter === 'active' ? !t.completed : filter === 'completed' ? t.completed : true);

    const activeCount = todos.filter(t => !t.completed).length;
    const completedCount = todos.filter(t => t.completed).length;

    const signOut = () => auth.signOut();

    return React.createElement("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 md:p-8"},
      React.createElement("div",{className:"max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-6 md:p-8"},
        React.createElement("div",{className:"flex items-center justify-between mb-4"},
          React.createElement("div",null, React.createElement("h1",{className:"text-3xl font-bold"},"Get S**t Done!")),
          React.createElement("div",{className:"text-right"},
            React.createElement("div",{className:"text-sm text-gray-500"},"Signed in as"),
            React.createElement("div",{className:"flex items-center gap-2"},
              React.createElement("div",{className:"text-gray-700 font-medium"}, user.email || user.displayName || user.uid.slice(0,6)),
              React.createElement("button",{onClick:signOut, className:"ml-2 px-3 py-1 rounded border text-sm text-gray-600"},"Sign out")
            )
          )
        ),

        React.createElement("div",{className:"flex gap-4 text-sm text-gray-500 mb-4"},
          React.createElement("span",null,`${activeCount} active`),
          React.createElement("span",null,"•"),
          React.createElement("span",null,`${completedCount} completed`),
          React.createElement("span",null,"•"),
          React.createElement("span",null,`${todos.length} total`)
        ),

        // Add new task panel
        React.createElement("div",{className:"bg-gray-50 rounded-xl p-4 mb-6 space-y-3"},
          React.createElement("input",{type:"text",value:input,onChange:e=>setInput(e.target.value),onKeyDown:e=>{ if(e.key==='Enter') addTodo(); },placeholder:"Add a new task...",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-500 transition-colors"}),

          React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3"},
            React.createElement("div",null,
              React.createElement("label",{className:"block text-xs font-medium text-gray-600 mb-1"},"Category"),
              React.createElement("select",{value:category,onChange:e=>setCategory(e.target.value),className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-500"},
                React.createElement("option",{value:""},"Select..."),
                categories.map(cat => React.createElement("option",{key:cat,value:cat},cat))
              )
            ),
            React.createElement("div",null,
              React.createElement("label",{className:"block text-xs font-medium text-gray-600 mb-1"},"Due Date"),
              React.createElement("input",{type:"date",value:dueDate,onChange:e=>setDueDate(e.target.value),className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-500"})
            ),
            React.createElement("div",null,
              React.createElement("label",{className:"block text-xs font-medium text-gray-600 mb-1"},"Priority"),
              React.createElement("select",{value:priority,onChange:e=>setPriority(e.target.value),className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-500"},
                priorities.map(p => React.createElement("option",{key:p,value:p}, p.charAt(0).toUpperCase() + p.slice(1) ))
              )
            )
          ),

          React.createElement("div",{className:"flex gap-2"},
            React.createElement("button",{onClick:addTodo,className:"flex-1 bg-indigo-500 hover:bg-indigo-600 text-white px-6 py-3 rounded-lg flex items-center justify-center gap-2 transition-colors"},
              React.createElement(Plus,{size:18}),
              "Add Task"
            ),
            React.createElement("button",{onClick:clearCompleted,className:"px-4 py-2 rounded-lg bg-yellow-100 text-yellow-700 hover:bg-yellow-200"},"Clear Completed"),
            React.createElement("button",{onClick:clearAll,className:"px-4 py-2 rounded-lg bg-red-100 text-red-700 hover:bg-red-200"},"Clear All")
          )
        ),

        // Filters
        React.createElement("div",{className:"flex gap-2 mb-6 flex-wrap"},
          ['all','active','completed'].map(f =>
            React.createElement("button",{key:f,onClick:()=>setFilter(f),className:`px-4 py-2 rounded-lg transition-colors ${filter===f ? 'bg-indigo-500 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}`},
              f.charAt(0).toUpperCase() + f.slice(1),
              ' ',
              f==='all'?`(${todos.length})` : f==='active'? `(${activeCount})` : `(${completedCount})`
            )
          )
        ),

        // Task list
        loading ? React.createElement("div",{className:"p-6 text-center text-gray-400"},"Loading tasks...") :
        React.createElement("div",{className:"space-y-2"},
          filtered.length === 0 ? React.createElement("p",{className:"text-center text-gray-400 py-12"}, filter === 'all' ? 'No tasks yet. Add one to get started!' : `No ${filter} tasks.`) :
          filtered.map(todo => React.createElement("div",{key:todo.id,className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors group"},
            React.createElement("div",{className:"flex items-start gap-3"},
              React.createElement("button",{onClick:()=>toggleTodo(todo.id, todo.completed),className:`flex-shrink-0 w-6 h-6 rounded border-2 flex items-center justify-center transition-all mt-1 ${todo.completed ? 'bg-indigo-500 border-indigo-500' : 'border-gray-300 hover:border-indigo-400'}`},
                todo.completed && React.createElement(Check,{size:16})
              ),
              React.createElement("div",{className:"flex-1 min-w-0"},
                editingId === todo.id ? React.createElement("div",{className:"flex gap-2"},
                  React.createElement("input",{type:"text",value:editText,onChange:e=>setEditText(e.target.value),onKeyDown:e=>e.key==='Enter'&&saveEdit(todo.id),className:"flex-1 px-3 py-1 border-2 border-indigo-500 rounded focus:outline-none",autoFocus:true}),
                  React.createElement("button",{onClick:()=>saveEdit(todo.id),className:"text-green-600 hover:text-green-700"}, React.createElement(Check,{size:18}) ),
                  React.createElement("button",{onClick:()=>{ setEditingId(null); setEditText(''); }, className:"text-red-600 hover:text-red-700"}, React.createElement(X,{size:18}) )
                ) :
                React.createElement(React.Fragment,null,
                  React.createElement("div",{className:"flex items-start justify-between gap-2"},
                    React.createElement("span",{className:`text-gray-700 break-words ${todo.completed ? 'line-through text-gray-400' : ''}`}, todo.text),
                    React.createElement("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0"},
                      React.createElement("button",{onClick:()=>startEdit(todo),className:"text-blue-500 hover:text-blue-600"}, React.createElement(Edit2,{size:16}) ),
                      React.createElement("button",{onClick:()=>deleteTodo(todo.id),className:"text-red-500 hover:text-red-600"}, React.createElement(Trash2,{size:16}) )
                    )
                  ),

                  // tags row
                  React.createElement("div",{className:"flex flex-wrap gap-2 mt-2"},
                    React.createElement("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs border ${ todo.priority === 'high' ? 'text-red-600 bg-red-50 border-red-200' : todo.priority === 'medium' ? 'text-yellow-600 bg-yellow-50 border-yellow-200' : 'text-green-600 bg-green-50 border-green-200' }`},
                      React.createElement(AlertCircle,{size:12}),
                      todo.priority
                    ),
                    React.createElement("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs bg-purple-50 text-purple-600 border border-purple-200"},
                      React.createElement(Tag,{size:12}),
                      todo.category || 'Other'
                    ),
                    todo.dueDate ? React.createElement("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs border ${ isOverdue(todo.dueDate) && !todo.completed ? 'bg-red-50 text-red-600 border-red-200' : 'bg-blue-50 text-blue-600 border-blue-200' }`},
                      React.createElement(Calendar,{size:12}),
                      (todo.dueDate && todo.dueDate.seconds) ? new Date(todo.dueDate.seconds*1000).toLocaleDateString() : (typeof todo.dueDate === 'string' ? formatDate(todo.dueDate) : String(todo.dueDate)),
                      isOverdue(todo.dueDate) && !todo.completed ? ' (Overdue)' : null
                    ) : null
                  )
                )
              )
            )
          ))
        )
      )
    );
  }

  // Mount app
  const root = ReactDOM.createRoot(document.getElementById('root'));
  root.render(React.createElement(App));
  </script>

  <!-- Optional: service worker registration for caching static assets (create service-worker.js separately) -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js').catch(e => {
          // console.warn('SW failed', e);
        });
      });
    }
  </script>
</body>
</html>